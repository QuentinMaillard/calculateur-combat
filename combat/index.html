<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Combat - Guerre des Gaules</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 64 64%22><text y=%2252%22 font-size=%2250%22>âš”ï¸</text></svg>">
    <link rel="stylesheet" href="style.css">
</head>

<div id="fade-black"
    style="display:none; position:fixed; inset:0; background:#000; z-index:2999; opacity:0; transition:opacity 0.5s;">
</div>

<body>
    <a href="../index.html" class="home-button">ğŸ  Accueil</a>

<div id="countdown-overlay"
    style="display:none; position:fixed; inset:0; background:rgba(60,50,30,0.85); z-index:3000; align-items:center; justify-content:center; flex-direction:column; overflow:hidden;">

    <video id="countdown-bg-video" src="Assets/baggare.mp4" autoplay muted loop playsinline
        style="position:absolute; inset:0; width:100vw; height:100vh; object-fit:cover; z-index:0; opacity:0.25; pointer-events:none;">
    </video>
    <h1 style="color:#fffbe6; font-family:'IM Fell DW Pica',serif; z-index:1;">âš”ï¸ Les dÃ©s sont jettÃ©s  âš”ï¸ <br><br> Les fiers guerriers rejoignent maintenant le
        champ de bataille...
    </h1>
    <div id="countdown-number"
        style="font-size:5em; color:#fffbe6; font-family:'IM Fell DW Pica',serif; text-shadow:2px 2px 8px #000; margin-bottom:20px; z-index:1;">
        5
    </div>
</div>
<canvas id="confetti-canvas" style="display:none; position:fixed; pointer-events:none; inset:0; z-index:4000;"></canvas>

<body>
    <div class="container">
        <h1>âš”ï¸ Calculateur de Combat - Guerre des Gaules âš”ï¸</h1>

        <!-- Ã‰tape 1 : Saisie des informations -->
        <div class="combat-card" id="step1">
            <div class="combat-grid">
                <div class="combat-section attaquant-section">
                    <h2 class="section-title">Attaquant ğŸ¤º</h2>
                    <div class="attaquant-box">
                        <div class="form-group">
                            <label for="attaquant-nom">ğŸ˜ï¸ Nom de l'attaquant <span>*</span></label>
                            <input type="text" id="attaquant-nom" placeholder="Ex: Les IrrÃ©ductibles">
                        </div>

                        <div class="g1-m1-row">
                            <div class="form-group">
                                <label for="attaquant-guerriers">ğŸ§ Guerriers mobilisÃ©s (G1) <span>*</span></label>
                                <input type="number" id="attaquant-guerriers" min="0" value="">
                            </div>
                            <div class="form-group">
                                <label for="attaquant-potions">
                                    ğŸ§ª Potions utilisÃ©es <span id="attaquant-potions-max-label">(Max: <span
                                            id="attaquant-potions-max">0</span>)</span>
                                </label>
                                <input type="number" id="attaquant-potions" min="0" value="0">
                            </div>
                        </div>

                        <div class="action-desirees-grid">
                            <div class="form-group action-desirees-group">
                                <label for="action-desiree">ğŸ¯ Action dÃ©sirÃ©e <span>*</span></label>
                                <select id="action-desiree">
                                    <option value="potion">ğŸ§ª Piller les potions !</option>
                                    <option value="materiaux">ğŸ§± Piller des MatÃ©riaux !</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="combat-section defenseur-section">
                    <h2 class="section-title">DÃ©fenseur(s) ğŸ›¡ï¸</h2>

                    <!-- DÃ©fenseur principal -->
                    <div class="defenseur-box">
                        <div class="form-group">
                            <label for="defenseur1-nom">ğŸ˜ï¸ Nom du dÃ©fenseur <span>*</span></label>
                            <input type="text" id="defenseur1-nom" placeholder="Ex: Les Poissonniers">
                        </div>
                        <div class="g2-oppidum-row">
                            <div class="form-group">
                                <label for="defenseur1-guerriers">ğŸ§ Guerriers mobilisÃ©s (G2) <span>*</span></label>
                                <input type="number" id="defenseur1-guerriers" min="0" value="">
                            </div>
                            <div class="form-group oppidum-group" style="margin-bottom:0;">
                                <span class="oppidum-label">ğŸ° Oppidum</span>
                                <div class="switch-container">
                                    <label class="switch">
                                        <input type="checkbox" id="oppidum-actif">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="village-grid" id="ressources-disponibles-group">
                            <div class="form-group" id="potions-dispo-group">
                                <label for="potions-disponibles">ğŸ§ª Total Potions possÃ©dÃ©es<span>*</span></label>
                                <input type="number" id="potions-disponibles" min="0" value="">
                            </div>
                            <div class="form-group" id="materiaux-dispo-group" style="display:none;">
                                <label for="materiaux-disponibles">ğŸ§± Total MatÃ©riaux possÃ©dÃ©es<span>*</span></label>
                                <input type="number" id="materiaux-disponibles" min="0" value="">
                            </div>
                        </div>
                    </div>

                    <!-- Bouton pour ajouter un alliÃ© -->
                    <div style="text-align:center; margin-bottom: 12px;">
                        <button type="button" id="toggle-allie-btn" class="next-btn"
                            style="padding: 8px 28px; font-size:1em; border-radius:6px; margin-top: 0;">
                            + Ajouter un dÃ©fenseur alliÃ© (optionnel)
                        </button>
                    </div>

                    <!-- DÃ©fenseur alliÃ© (cachÃ© par dÃ©faut) -->
                    <div class="defenseur-box" id="defenseur-allie-box">
                        <div class="form-group">
                            <label for="defenseur2-nom">ğŸ˜ï¸ Nom du dÃ©fenseur alliÃ© <span
                                    id="defenseur2-nom-star">*</span></label>
                            <input type="text" id="defenseur2-nom" placeholder="Ex: Les Forgerons">
                        </div>
                        <div class="village-grid">
                            <div class="form-group">
                                <label for="defenseur2-guerriers">ğŸ§ Guerriers alliÃ©s (G3) <span
                                        id="defenseur2-guerriers-star">*</span></label>
                                <input type="number" id="defenseur2-guerriers" min="0" value="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <div class="error-message" id="error-message"></div>
                <button class="next-btn" id="valider-preparatifs-btn" onclick="validerEtape1()" disabled>Valider les
                    prÃ©paratifs...</button>
            </div>
        </div>

        <!-- Ã‰tape 2 : Jets de dÃ©s -->
        <div class="dice-section" id="step2">
            <div class="dice-card">
                <h2 class="result-title">RÃ©capitulatif du Combat</h2>
                <div style="text-align: center;background: #fffbe6; border-left: 5px solid #bfa76a; color: #6b5b2b; padding: 12px 18px; margin: 18px 0; border-radius: 6px; font-size: 1em;">
                    Prenez soin de vÃ©rifier que ces donnÃ©es correspondent bien Ã  votre stratÃ©gie, mais aussi Ã  la rÃ©alitÃ© de vos ressources et vos effectifs. <br><br> Si vous n'Ãªtes pas sÃ»rs, faites appel au Maitre de Salle!
                </div>

                <div class="summary-section">
                    <div class="summary-grid">
                        <div class="summary-box">
                            <h3>ğŸ¤º <span id="summary-attaquant-nom"></span></h3>
                            <div class="summary-line"><strong>Guerriers engagÃ©s (G1) :</strong> <span
                                    id="summary-attaquant-guerriers"></span></div>
                            <div class="summary-line"><strong>Guerriers sous potion (M1) :</strong> <span
                                    id="summary-attaquant-potions"></span></div>
                            <div class="summary-line"><strong>Ressources dÃ©sirÃ©es :</strong> <span
                                    id="summary-ressources"></span></div>
                        </div>

                        <div class="summary-box">
                            <h3>ğŸ›¡ï¸ <span id="summary-defenseur-nom"></span></h3>
                            <div class="summary-line"><strong>Guerriers (G2) :</strong> <span
                                    id="summary-defenseur-guerriers"></span></div>
                            <div class="summary-line"><strong>Oppidum prÃ©sent :</strong> <span
                                    id="summary-oppidum"></span></div>
                            <div class="summary-line" id="summary-defenseur-ressources-line">
                                <strong>Ressources disponibles :</strong>
                                <span id="summary-defenseur-ressources"></span>
                            </div>
                            <div class="summary-line" id="summary-allie-line" style="display: none;">
                                <strong>AlliÃ© <span id="summary-allie-nom"></span> (G3) :</strong> <span
                                    id="summary-allie-guerriers"></span> guerriers
                            </div>
                        </div>
                    </div>
                </div>

                <h3 style="text-align: center; margin-bottom: 20px; color: #333; font-size: 1.5em;">Et maintenant, lancez les dÃ©s du destin !
                </h3>
                <div style="text-align:center; color:#666; font-size:1.5em; margin-bottom:28px; font-style:italic;">
                    Que Toutatis soit avec vous ! âš¡
                </div>


                <div class="dice-random-section" style="margin-bottom: 18px;">
                    <div id="dice-roll-result" style="display:flex; flex-direction:row; align-items:center; justify-content:center; gap:32px; margin-top:18px; width:100%;">
                        <div class="dice-box attaquant" style="display:flex; flex-direction:column; align-items:center;">
                            <h3>ğŸ² Attaquant</h3>
                            <span id="attaquant-de-result" style="font-size:2em; color:#bfa76a; min-height:1.5em;">?</span>
                            <button class="roll-dice-btn" id="roll-dice-attaquant" style="margin-top:12px; font-size:1em; padding:8px 18px; border-radius:8px; background:#bfa76a; color:#fffbe6; border:none; cursor:pointer;">Lancer le dÃ©</button>
                        </div>
                        <div class="dice-separator">âš”ï¸</div>
                        <div class="dice-box defenseur" style="display:flex; flex-direction:column; align-items:center;">
                            <h3>ğŸ² DÃ©fenseur</h3>
                            <span id="defenseur-de-result" style="font-size:2em; color:#bfa76a; min-height:1.5em;">?</span>
                            <button class="roll-dice-btn" id="roll-dice-defenseur" style="margin-top:12px; font-size:1em; padding:8px 18px; border-radius:8px; background:#bfa76a; color:#fffbe6; border:none; cursor:pointer;">Lancer le dÃ©</button>
                        </div>
                    </div>
                </div>
                <div class="button-container">
                    <div class="error-message" id="error-message-dice"></div>
                    <button class="calculate-btn" id="calculate-btn" onclick="calculerCombat()" disabled>Lancer la bataille !</button>
                </div>
            </div>
        </div>

        <!-- Ã‰tape 3 : RÃ©sultats -->
        <div class="results" id="results">
            <div class="result-card">
                <h2 class="result-title">RÃ©sultats du Combat</h2>
                <div id="results-content"></div>
                <div class="button-container">
                    <button class="reset-btn" onclick="recommencer()">Nouveau Combat</button>
                </div>
            </div>
        </div>

        <!-- Bouton d'aide en bas Ã  droite -->
        <button id="help-btn" aria-label="Afficher les rÃ¨gles">â“</button>

        <!-- Modale des rÃ¨gles -->
        <div id="rules-modal" class="modal-overlay" tabindex="-1" aria-modal="true" style="display:none;">
            <div class="modal-content" role="dialog" aria-labelledby="modal-title">
                <button class="modal-close" id="close-modal" aria-label="Fermer">âœ•</button>
                <h2 id="modal-title" class="section-title" style="margin-top:0;">ğŸ§® Calcul des rÃ©sultats</h2>
                <div class="modal-scroll" id="modal-scroll">
                    <h3 class="modal-subtitle">RÃ©sultats ğŸ†</h3>
                    <ul>
                        <li>RÃ©sultat de victoire <code>R</code> = Valeur d'attaque <code>A</code> - Valeur de dÃ©fense
                            <code>D</code>
                            <ul>
                                <li><code>A</code> = Nombre de guerriers engagÃ©s (<code>G1</code>) + jet de dÃ© 10
                                    <code>J1</code></li>
                                <li><code>D</code> = Nombre total de guerriers (<code>G2</code> + <code>G3</code>) x2
                                    (si oppidum) + jet de dÃ© 10 <code>J2</code></li>
                            </ul>
                        </li>
                        <li>Si <code>R &gt; 0</code>, attaquant gagne. Si <code>R &lt; 0</code>, dÃ©fenseur gagne.</li>
                    </ul>
                    <h3 class="modal-subtitle">Ressources volÃ©es ğŸ¥·</h3>
                    <ul>
                        <li>
                            <strong>Voler de la potion est plus difficileâ€¯:</strong> Si l'attaquant choisit de piller
                            des potions, la quantitÃ© volÃ©e est divisÃ©e par 2 (arrondi Ã  l'entier supÃ©rieur), car la
                            potion est une ressource plus difficile Ã  rÃ©cupÃ©rer.
                        </li>
                        <li>
                            Calcul des ressources volÃ©es (<code>V</code>) :
                            <ul>
                                <li>Si <code>R â‰¤ 0</code> (dÃ©fenseur gagne), <code>V = 0</code> (lâ€™attaquant repart
                                    bredouilleâ€¯!)</li>
                                <li>Sinon si <code>R &gt; 0</code> (attaquant gagne), <code>V = R / 2</code> (arrondi Ã 
                                    l'entier supÃ©rieur)</li>
                                <li>Si la ressource pillÃ©e est la potion, <code>V</code> est Ã  nouveau divisÃ© par 2
                                    (arrondi Ã  l'entier supÃ©rieur)</li>
                                <li>
                                    <strong>On ne vole jamais plus que le stock disponibleâ€¯:</strong> si <code>V</code>
                                    dÃ©passe la quantitÃ© de la ressource ciblÃ©e, l'attaquant ne prend que ce qui est
                                    disponible.
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <h3 class="modal-subtitle">Potion magique ğŸ§ª (uniquement pour l'attaquant)</h3>
                    <ul>
                        <li>
                            <strong>Seul l'attaquant peut utiliser la potion magique.</strong>
                        </li>
                        <li>
                            <strong>Chaque potion utilisÃ©e donne un bonus de +0,5 Ã  la force d'attaque.</strong>
                        </li>
                        <li>
                            <strong>De plus, chaque potion utilisÃ©e protÃ¨ge un guerrier de la mort lors de cette
                                bataille.</strong>
                        </li>
                        <li>
                            <strong>Calculâ€¯:</strong> La valeur d'attaque devient :
                            <code>A = G1 + J1 + (M1 Ã— 0,5)</code> oÃ¹ G1 = guerriers, J1 = jet de dÃ©, M1 = potions
                            utilisÃ©es.<br>
                            AprÃ¨s le calcul des pertes, on soustrait le nombre de potions utilisÃ©es au nombre de pertes
                            subies par l'attaquant (sans jamais descendre sous zÃ©ro).
                        </li>
                        <li>
                            <strong>Exempleâ€¯:</strong> Si l'attaquant engage 10 guerriers, utilise 4 potions et fait un
                            jet de dÃ© de 7, sa valeur d'attaque sera <code>10 + 7 + (4 Ã— 0,5) = 19</code>.<br>
                            Si l'attaquant devait perdre 5 guerriers, il n'en perdra effectivement qu'1 grÃ¢ce Ã  ses 4
                            potions.
                        </li>
                        <li>
                            <strong>Le dÃ©fenseur ne peut jamais utiliser de potion magique.</strong>
                        </li>
                    </ul>
                    <h3 class="modal-subtitle">Pertes humaines â˜ ï¸</h3>
                    <ul>
                        <li>
                            <strong>Les pertes de chaque camp dÃ©pendent de trois facteurs :</strong>
                            <ul>
                                <li>La taille relative des armÃ©es</li>
                                <li>L'issue du combat (victoire/dÃ©faite)</li>
                                <li>L'Ã©cart entre les jets de dÃ©s</li>
                                <li>La prÃ©sence Ã©ventuelle de oppidum</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Oppidum :</strong> Si le dÃ©fenseur active "oppidum" (il faut pour cela qu'il ait
                            achetÃ© les remparts), un <strong>bonus de dÃ©fense</strong> proportionnel au total du nombre de
                            guerriers dÃ©fenseurs (dont alliÃ©s) est appliquÃ© pour le calcul de la dÃ©fense et des pertes,
                            rendant la position
                            dÃ©fensive beaucoup plus solide.
                        </li>
                        <li>
                            De plus, si lâ€™oppidum est activÃ©, <strong>chaque guerrier dÃ©fenseur</strong> perdu a <strong>1 chance sur 2 dâ€™Ãªtre sauvÃ©</strong> grÃ¢ce Ã  la protection de la fortification.
                        </li>
                        <li>Une grande armÃ©e affrontant une petite subira peu de pertes, particuliÃ¨rement en cas de
                            victoire.</li>
                        <li>Une petite armÃ©e victorieuse ou obtenant un jet de dÃ© nettement supÃ©rieur inflige davantage
                            de pertes Ã  l'adversaire tout en limitant ses propres pertes.</li>
                        <li>En cas de dÃ©faite, une petite armÃ©e subira des pertes plus lourdes, surtout si l'Ã©cart de
                            force ou de dÃ©s est important.</li>
                        <li>Les bonus ou malus liÃ©s aux jets de dÃ©s peuvent accentuer ou attÃ©nuer les pertes selon
                            l'Ã©cart de chance entre les deux camps.</li>
                        <li><strong>Fort heureusement, câ€™est lâ€™application qui sâ€™occupe de faire ce calcul
                                compliquÃ©.</strong></li>
                    </ul>
                </div>
                <div id="scroll-arrow" style="display:none;" aria-hidden="true">
                    <span
                        style="display:block; text-align:center; font-size:2em; color:#bfa76a; pointer-events:none; user-select:none;">
                        â†“
                    </span>
                </div>
            </div>
        </div>
    </div>

    <footer
        style="width:100%; display:flex; justify-content:center; align-items:center; padding:32px 0 12px 0; background:transparent;">
        <a href="https://www.linkedin.com/company/104192580/" target="_blank">
            <img src="Assets/fondations.png" alt="Fondations"
                style="width:300px; max-width:90vw; height:auto; display:block;">
        </a>
    </footer>

    <script src="script.js"></script>
</body>

</html>