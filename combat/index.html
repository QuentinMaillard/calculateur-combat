<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Combat - Guerre des Gaules</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 64 64%22><text y=%2252%22 font-size=%2250%22>⚔️</text></svg>">
    <link rel="stylesheet" href="style.css">
</head>

<div id="fade-black"
    style="display:none; position:fixed; inset:0; background:#000; z-index:2999; opacity:0; transition:opacity 0.5s;">
</div>

<body>
    <a href="../index.html" class="home-button">🏠 Accueil</a>

<div id="countdown-overlay"
    style="display:none; position:fixed; inset:0; background:rgba(60,50,30,0.85); z-index:3000; align-items:center; justify-content:center; flex-direction:column; overflow:hidden;">

    <video id="countdown-bg-video" src="Assets/baggare.mp4" autoplay muted loop playsinline
        style="position:absolute; inset:0; width:100vw; height:100vh; object-fit:cover; z-index:0; opacity:0.25; pointer-events:none;">
    </video>
    <h1 style="color:#fffbe6; font-family:'IM Fell DW Pica',serif; z-index:1;">⚔️ Les dés sont jettés  ⚔️ <br><br> Les fiers guerriers rejoignent maintenant le
        champ de bataille...
    </h1>
    <div id="countdown-number"
        style="font-size:5em; color:#fffbe6; font-family:'IM Fell DW Pica',serif; text-shadow:2px 2px 8px #000; margin-bottom:20px; z-index:1;">
        5
    </div>
</div>
<canvas id="confetti-canvas" style="display:none; position:fixed; pointer-events:none; inset:0; z-index:4000;"></canvas>

<body>
    <div class="container">
        <h1>⚔️ Calculateur de Combat - Guerre des Gaules ⚔️</h1>

        <!-- Étape 1 : Saisie des informations -->
        <div class="combat-card" id="step1">
            <div class="combat-grid">
                <div class="combat-section attaquant-section">
                    <h2 class="section-title">Attaquant 🤺</h2>
                    <div class="attaquant-box">
                        <div class="form-group">
                            <label for="attaquant-nom">🏘️ Nom de l'attaquant <span>*</span></label>
                            <input type="text" id="attaquant-nom" placeholder="Ex: Les Irréductibles">
                        </div>

                        <div class="g1-m1-row">
                            <div class="form-group">
                                <label for="attaquant-guerriers">🧝 Guerriers mobilisés (G1) <span>*</span></label>
                                <input type="number" id="attaquant-guerriers" min="0" value="">
                            </div>
                            <div class="form-group">
                                <label for="attaquant-potions">
                                    🧪 Potions utilisées <span id="attaquant-potions-max-label">(Max: <span
                                            id="attaquant-potions-max">0</span>)</span>
                                </label>
                                <input type="number" id="attaquant-potions" min="0" value="0">
                            </div>
                        </div>

                        <div class="action-desirees-grid">
                            <div class="form-group action-desirees-group">
                                <label for="action-desiree">🎯 Action désirée <span>*</span></label>
                                <select id="action-desiree">
                                    <option value="potion">🧪 Piller les potions !</option>
                                    <option value="materiaux">🧱 Piller des Matériaux !</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="combat-section defenseur-section">
                    <h2 class="section-title">Défenseur(s) 🛡️</h2>

                    <!-- Défenseur principal -->
                    <div class="defenseur-box">
                        <div class="form-group">
                            <label for="defenseur1-nom">🏘️ Nom du défenseur <span>*</span></label>
                            <input type="text" id="defenseur1-nom" placeholder="Ex: Les Poissonniers">
                        </div>
                        <div class="g2-oppidum-row">
                            <div class="form-group">
                                <label for="defenseur1-guerriers">🧝 Guerriers mobilisés (G2) <span>*</span></label>
                                <input type="number" id="defenseur1-guerriers" min="0" value="">
                            </div>
                            <div class="form-group oppidum-group" style="margin-bottom:0;">
                                <span class="oppidum-label">🏰 Oppidum</span>
                                <div class="switch-container">
                                    <label class="switch">
                                        <input type="checkbox" id="oppidum-actif">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="village-grid" id="ressources-disponibles-group">
                            <div class="form-group" id="potions-dispo-group">
                                <label for="potions-disponibles">🧪 Total Potions possédées<span>*</span></label>
                                <input type="number" id="potions-disponibles" min="0" value="">
                            </div>
                            <div class="form-group" id="materiaux-dispo-group" style="display:none;">
                                <label for="materiaux-disponibles">🧱 Total Matériaux possédées<span>*</span></label>
                                <input type="number" id="materiaux-disponibles" min="0" value="">
                            </div>
                        </div>
                    </div>

                    <!-- Bouton pour ajouter un allié -->
                    <div style="text-align:center; margin-bottom: 12px;">
                        <button type="button" id="toggle-allie-btn" class="next-btn"
                            style="padding: 8px 28px; font-size:1em; border-radius:6px; margin-top: 0;">
                            + Ajouter un défenseur allié (optionnel)
                        </button>
                    </div>

                    <!-- Défenseur allié (caché par défaut) -->
                    <div class="defenseur-box" id="defenseur-allie-box">
                        <div class="form-group">
                            <label for="defenseur2-nom">🏘️ Nom du défenseur allié <span
                                    id="defenseur2-nom-star">*</span></label>
                            <input type="text" id="defenseur2-nom" placeholder="Ex: Les Forgerons">
                        </div>
                        <div class="village-grid">
                            <div class="form-group">
                                <label for="defenseur2-guerriers">🧝 Guerriers alliés (G3) <span
                                        id="defenseur2-guerriers-star">*</span></label>
                                <input type="number" id="defenseur2-guerriers" min="0" value="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <div class="error-message" id="error-message"></div>
                <button class="next-btn" id="valider-preparatifs-btn" onclick="validerEtape1()" disabled>Valider les
                    préparatifs...</button>
            </div>
        </div>

        <!-- Étape 2 : Jets de dés -->
        <div class="dice-section" id="step2">
            <div class="dice-card">
                <h2 class="result-title">Récapitulatif du Combat</h2>
                <div style="text-align: center;background: #fffbe6; border-left: 5px solid #bfa76a; color: #6b5b2b; padding: 12px 18px; margin: 18px 0; border-radius: 6px; font-size: 1em;">
                    Prenez soin de vérifier que ces données correspondent bien à votre stratégie, mais aussi à la réalité de vos ressources et vos effectifs. <br><br> Si vous n'êtes pas sûrs, faites appel au Maitre de Salle!
                </div>

                <div class="summary-section">
                    <div class="summary-grid">
                        <div class="summary-box">
                            <h3>🤺 <span id="summary-attaquant-nom"></span></h3>
                            <div class="summary-line"><strong>Guerriers engagés (G1) :</strong> <span
                                    id="summary-attaquant-guerriers"></span></div>
                            <div class="summary-line"><strong>Guerriers sous potion (M1) :</strong> <span
                                    id="summary-attaquant-potions"></span></div>
                            <div class="summary-line"><strong>Ressources désirées :</strong> <span
                                    id="summary-ressources"></span></div>
                        </div>

                        <div class="summary-box">
                            <h3>🛡️ <span id="summary-defenseur-nom"></span></h3>
                            <div class="summary-line"><strong>Guerriers (G2) :</strong> <span
                                    id="summary-defenseur-guerriers"></span></div>
                            <div class="summary-line"><strong>Oppidum présent :</strong> <span
                                    id="summary-oppidum"></span></div>
                            <div class="summary-line" id="summary-defenseur-ressources-line">
                                <strong>Ressources disponibles :</strong>
                                <span id="summary-defenseur-ressources"></span>
                            </div>
                            <div class="summary-line" id="summary-allie-line" style="display: none;">
                                <strong>Allié <span id="summary-allie-nom"></span> (G3) :</strong> <span
                                    id="summary-allie-guerriers"></span> guerriers
                            </div>
                        </div>
                    </div>
                </div>

                <h3 style="text-align: center; margin-bottom: 20px; color: #333; font-size: 1.5em;">Et maintenant, lancez les dés du destin !
                </h3>
                <div style="text-align:center; color:#666; font-size:1.5em; margin-bottom:28px; font-style:italic;">
                    Que Toutatis soit avec vous ! ⚡
                </div>


                <div class="dice-random-section" style="margin-bottom: 18px;">
                    <div id="dice-roll-result" style="display:flex; flex-direction:row; align-items:center; justify-content:center; gap:32px; margin-top:18px; width:100%;">
                        <div class="dice-box attaquant" style="display:flex; flex-direction:column; align-items:center;">
                            <h3>🎲 Attaquant</h3>
                            <span id="attaquant-de-result" style="font-size:2em; color:#bfa76a; min-height:1.5em;">?</span>
                            <button class="roll-dice-btn" id="roll-dice-attaquant" style="margin-top:12px; font-size:1em; padding:8px 18px; border-radius:8px; background:#bfa76a; color:#fffbe6; border:none; cursor:pointer;">Lancer le dé</button>
                        </div>
                        <div class="dice-separator">⚔️</div>
                        <div class="dice-box defenseur" style="display:flex; flex-direction:column; align-items:center;">
                            <h3>🎲 Défenseur</h3>
                            <span id="defenseur-de-result" style="font-size:2em; color:#bfa76a; min-height:1.5em;">?</span>
                            <button class="roll-dice-btn" id="roll-dice-defenseur" style="margin-top:12px; font-size:1em; padding:8px 18px; border-radius:8px; background:#bfa76a; color:#fffbe6; border:none; cursor:pointer;">Lancer le dé</button>
                        </div>
                    </div>
                </div>
                <div class="button-container">
                    <div class="error-message" id="error-message-dice"></div>
                    <button class="calculate-btn" id="calculate-btn" onclick="calculerCombat()" disabled>Lancer la bataille !</button>
                </div>
            </div>
        </div>

        <!-- Étape 3 : Résultats -->
        <div class="results" id="results">
            <div class="result-card">
                <h2 class="result-title">Résultats du Combat</h2>
                <div id="results-content"></div>
                <div class="button-container">
                    <button class="reset-btn" onclick="recommencer()">Nouveau Combat</button>
                </div>
            </div>
        </div>

        <!-- Bouton d'aide en bas à droite -->
        <button id="help-btn" aria-label="Afficher les règles">❓</button>

        <!-- Modale des règles -->
        <div id="rules-modal" class="modal-overlay" tabindex="-1" aria-modal="true" style="display:none;">
            <div class="modal-content" role="dialog" aria-labelledby="modal-title">
                <button class="modal-close" id="close-modal" aria-label="Fermer">✕</button>
                <h2 id="modal-title" class="section-title" style="margin-top:0;">🧮 Calcul des résultats</h2>
                <div class="modal-scroll" id="modal-scroll">
                    <h3 class="modal-subtitle">Résultats 🏆</h3>
                    <ul>
                        <li>Résultat de victoire <code>R</code> = Valeur d'attaque <code>A</code> - Valeur de défense
                            <code>D</code>
                            <ul>
                                <li><code>A</code> = Nombre de guerriers engagés (<code>G1</code>) + jet de dé 10
                                    <code>J1</code></li>
                                <li><code>D</code> = Nombre total de guerriers (<code>G2</code> + <code>G3</code>) x2
                                    (si oppidum) + jet de dé 10 <code>J2</code></li>
                            </ul>
                        </li>
                        <li>Si <code>R &gt; 0</code>, attaquant gagne. Si <code>R &lt; 0</code>, défenseur gagne.</li>
                    </ul>
                    <h3 class="modal-subtitle">Ressources volées 🥷</h3>
                    <ul>
                        <li>
                            <strong>Voler de la potion est plus difficile :</strong> Si l'attaquant choisit de piller
                            des potions, la quantité volée est divisée par 2 (arrondi à l'entier supérieur), car la
                            potion est une ressource plus difficile à récupérer.
                        </li>
                        <li>
                            Calcul des ressources volées (<code>V</code>) :
                            <ul>
                                <li>Si <code>R ≤ 0</code> (défenseur gagne), <code>V = 0</code> (l’attaquant repart
                                    bredouille !)</li>
                                <li>Sinon si <code>R &gt; 0</code> (attaquant gagne), <code>V = R / 2</code> (arrondi à
                                    l'entier supérieur)</li>
                                <li>Si la ressource pillée est la potion, <code>V</code> est à nouveau divisé par 2
                                    (arrondi à l'entier supérieur)</li>
                                <li>
                                    <strong>On ne vole jamais plus que le stock disponible :</strong> si <code>V</code>
                                    dépasse la quantité de la ressource ciblée, l'attaquant ne prend que ce qui est
                                    disponible.
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <h3 class="modal-subtitle">Potion magique 🧪 (uniquement pour l'attaquant)</h3>
                    <ul>
                        <li>
                            <strong>Seul l'attaquant peut utiliser la potion magique.</strong>
                        </li>
                        <li>
                            <strong>Chaque potion utilisée donne un bonus de +0,5 à la force d'attaque.</strong>
                        </li>
                        <li>
                            <strong>De plus, chaque potion utilisée protège un guerrier de la mort lors de cette
                                bataille.</strong>
                        </li>
                        <li>
                            <strong>Calcul :</strong> La valeur d'attaque devient :
                            <code>A = G1 + J1 + (M1 × 0,5)</code> où G1 = guerriers, J1 = jet de dé, M1 = potions
                            utilisées.<br>
                            Après le calcul des pertes, on soustrait le nombre de potions utilisées au nombre de pertes
                            subies par l'attaquant (sans jamais descendre sous zéro).
                        </li>
                        <li>
                            <strong>Exemple :</strong> Si l'attaquant engage 10 guerriers, utilise 4 potions et fait un
                            jet de dé de 7, sa valeur d'attaque sera <code>10 + 7 + (4 × 0,5) = 19</code>.<br>
                            Si l'attaquant devait perdre 5 guerriers, il n'en perdra effectivement qu'1 grâce à ses 4
                            potions.
                        </li>
                        <li>
                            <strong>Le défenseur ne peut jamais utiliser de potion magique.</strong>
                        </li>
                    </ul>
                    <h3 class="modal-subtitle">Pertes humaines ☠️</h3>
                    <ul>
                        <li>
                            <strong>Les pertes de chaque camp dépendent de trois facteurs :</strong>
                            <ul>
                                <li>La taille relative des armées</li>
                                <li>L'issue du combat (victoire/défaite)</li>
                                <li>L'écart entre les jets de dés</li>
                                <li>La présence éventuelle de oppidum</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Oppidum :</strong> Si le défenseur active "oppidum" (il faut pour cela qu'il ait
                            acheté les remparts), un <strong>bonus de défense</strong> proportionnel au total du nombre de
                            guerriers défenseurs (dont alliés) est appliqué pour le calcul de la défense et des pertes,
                            rendant la position
                            défensive beaucoup plus solide.
                        </li>
                        <li>
                            De plus, si l’oppidum est activé, <strong>chaque guerrier défenseur</strong> perdu a <strong>1 chance sur 2 d’être sauvé</strong> grâce à la protection de la fortification.
                        </li>
                        <li>Une grande armée affrontant une petite subira peu de pertes, particulièrement en cas de
                            victoire.</li>
                        <li>Une petite armée victorieuse ou obtenant un jet de dé nettement supérieur inflige davantage
                            de pertes à l'adversaire tout en limitant ses propres pertes.</li>
                        <li>En cas de défaite, une petite armée subira des pertes plus lourdes, surtout si l'écart de
                            force ou de dés est important.</li>
                        <li>Les bonus ou malus liés aux jets de dés peuvent accentuer ou atténuer les pertes selon
                            l'écart de chance entre les deux camps.</li>
                        <li><strong>Fort heureusement, c’est l’application qui s’occupe de faire ce calcul
                                compliqué.</strong></li>
                    </ul>
                </div>
                <div id="scroll-arrow" style="display:none;" aria-hidden="true">
                    <span
                        style="display:block; text-align:center; font-size:2em; color:#bfa76a; pointer-events:none; user-select:none;">
                        ↓
                    </span>
                </div>
            </div>
        </div>
    </div>

    <footer
        style="width:100%; display:flex; justify-content:center; align-items:center; padding:32px 0 12px 0; background:transparent;">
        <a href="https://www.linkedin.com/company/104192580/" target="_blank">
            <img src="Assets/fondations.png" alt="Fondations"
                style="width:300px; max-width:90vw; height:auto; display:block;">
        </a>
    </footer>

    <script src="script.js"></script>
</body>

</html>